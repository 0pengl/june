{% extends "layout.html" %}

{% block subtitle %}{{escape(topic.title)}}{% end %}

{% block afterstyle %}
{% if node.header %}
{{ node.header }}
{% end %}
{% end %}

{% block main %}
<div id="main">
    {% include "snippet/topic.html" %}
</div>
{% end %}

{% block sidebar %}
<div class="widget fn-clear">
    <h4 class="widget-title">{{ _("Topic Creator") }}</h4>
    {% set user = users[topic.user_id] %}
    <a class="avatar fn-left" href="/member/{{user.username}}" tabindex="-1"><img src="{{user.get_avatar(48)}}" alt="avatar" width="48" height="48" /></a>
    <div class="fn-wrap">
        <a href="/member/{{user.username}}">{{user.username}}</a>
        <div class="meta">
            {{ _("Reputation") }}: {{user.reputation}}
        </div>
    </div>
</div>

<div class="widget fn-clear">
    <h4 class="widget-title">{{ _("In Node") }}</h4>
    <div class="fn-wrap">
        <div class="vsep">
            <a class="node" href="/node/{{node.slug}}" style="{%if node.bgcolor%}background:{{node.bgcolor}};{% end %}{%if node.fgcolor%}color:{{node.fgcolor}}{%end%}">{{escape(node.title)}}</a>
        </div>
        <p>{{node.description}}</p>
    </div>
</div>

<div class="widget">
    {% if current_user and current_user.id == topic.user_id %}
    <a href="/topic/{{topic.id}}/edit" class="ui-btn">{{_("Edit Topic")}}</a>
    {% end %}
    <a href="/node/{{node.slug}}/topic" class="ui-btn">{{_("New Topic")}}</a>
</div>

{% if node.sidebar %}
{{ node.sidebar }}
{% end %}

<div class="widget">
    <h4 class="widget-title">{{ _("Vote") }}</h4>
    <div class="fn-wrap">
        {% for id in topic.up_users %}
        {% set user = users[id] %}
        <a href="/member/{{user.username}}" title="{{user.username}}"><img src="{{user.get_avatar(24)}}" /></a>
        {% end %}

        {% for id in topic.down_users %}
        {% set user = users[id] %}
        <a href="/member/{{user.username}}" title="{{user.username}}"><img src="{{user.get_avatar(24)}}" /></a>
        {% end %}
    </div>
</div>
{% end %}
